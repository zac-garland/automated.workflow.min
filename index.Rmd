---
title: "example automated dashboard"
output:
  rmdformats::downcute:
    self_contained: false
    code_folding: hide
    default_style: "dark"
    downcute_theme: "chaos"
---


```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = FALSE,message = FALSE, warning = FALSE)
```

<h1 id="date-diff"></h1>


```{r}
library(shiny)

`%>%` <- magrittr::`%>%`

plotly_elegant <- function(plot, ..., margin = 3, background = "rgba(20,20,21,1)", color = "#ffffff",size = 16) {
  plot %>%
    plotly::layout(
      xaxis = list(title = ""),
      yaxis = list(title = ""),
      font = list(color = color,family = "sans-serif",size = size),
      plot_bgcolor = background,
      paper_bgcolor = background,
      margin = margin
    ) %>%
    plotly::layout(...)
}



dat_tbl <- tidyquant::tq_get("AAPL") 

write.csv(dat_tbl,"data/dat_tbl.csv")

dat_tbl %>% 
  plotly::plot_ly(
    x = ~date,
    y = ~adjusted
  ) %>% 
  plotly::add_lines() %>% 
  plotly_elegant()


```


```{r}

cur_date <- Sys.time()
attr(cur_date,"tzone") <- "UTC"

tags$script(
  shiny::HTML('
 function get_time_diff( datetime ){
  var datetime = new Date( datetime ).getTime();
  var now = new Date().getTime();
  var milisec_diff = now - datetime;
  var msec = milisec_diff;
  var hh = Math.floor(msec / 1000 / 60 / 60);
  msec -= hh * 1000 * 60 * 60;
  var mm = Math.floor(msec / 1000 / 60);
  msec -= mm * 1000 * 60;
  var ss = Math.floor(msec / 1000);
  msec -= ss * 1000;
  return hh + " Hours " + mm + " Minutes " + ss + " Seconds";
}
')
)


tags$script(shiny::HTML(glue::glue('
$(function(){{
  $("#date-diff").html("Last Updated " + get_time_diff("{cur_date}") + " ago");    
}});
  
')))



```

# Latest Data

```{r}

dat_tbl %>% tail(1) %>% knitr::kable()

```

